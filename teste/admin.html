<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Admin - Editor de Conteúdo</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			body {
				font-family: 'Inter', sans-serif;
			}
			textarea {
				font-family: monospace;
				min-height: 500px;
			}
		</style>
	</head>
	<body class="bg-gray-900 text-white">
		<div class="container mx-auto p-4 md:p-8">
			<header class="mb-8">
				<h1 class="text-4xl font-bold text-orange-500">
					Editor de Conteúdo
				</h1>
				<p class="text-gray-400 mt-2">
					Altere o conteúdo das páginas nos campos abaixo. Clique em
					"Salvar Alterações" para publicar o conteúdo para todos os
					usuários.
				</p>
			</header>

			<!-- Estado de Carregamento -->
			<div
				id="loading-state"
				class="text-center p-8 bg-gray-800 rounded-lg"
			>
				<p>Carregando dados do Firebase...</p>
			</div>

			<!-- Estado de Inicialização (se o banco estiver vazio) -->
			<div
				id="initialization-state"
				class="hidden text-center p-8 bg-gray-800 rounded-lg border-2 border-dashed border-orange-500"
			>
				<h2 class="text-2xl font-semibold mb-4">
					Banco de dados vazio!
				</h2>
				<p class="mb-6 text-gray-300">
					Parece que é o primeiro acesso. Clique no botão abaixo para
					carregar o conteúdo inicial das páginas no Firebase.
				</p>
				<button
					id="initialize-button"
					class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300"
				>
					Carregar Conteúdo Inicial no Firebase
				</button>
			</div>

			<!-- Editor Principal -->
			<main id="editor-state" class="hidden">
				<div
					id="status-message"
					class="mb-6 p-4 rounded-lg text-center font-semibold hidden"
				></div>

				<div class="grid lg:grid-cols-2 gap-8">
					<!-- Formulário da Página Principal -->
					<div>
						<label
							for="homePageContent"
							class="text-2xl font-semibold text-gray-200 mb-2 block"
							>Página Principal (`index.html`)</label
						>
						<textarea
							id="homePageContent"
							class="w-full p-4 bg-gray-800 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition"
						></textarea>
					</div>
					<!-- Formulário da Página de Empresas -->
					<div>
						<label
							for="businessPageContent"
							class="text-2xl font-semibold text-gray-200 mb-2 block"
							>Página de Empresas (`wevity-Business.html`)</label
						>
						<textarea
							id="businessPageContent"
							class="w-full p-4 bg-gray-800 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition"
						></textarea>
					</div>
				</div>

				<div class="mt-8 text-center">
					<button
						id="save-button"
						class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 text-lg"
					>
						Salvar Alterações
					</button>
				</div>
			</main>
		</div>

		<!-- SDKs do Firebase -->
		<script type="module">
			import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
			import {
				getFirestore,
				doc,
				getDoc,
				setDoc,
			} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

			// Configuração do Firebase fornecida
			const firebaseConfig = {
				apiKey: 'AIzaSyDmScpF_IsLIWRtltZg09yDpOkYIyE1MrU',
				authDomain: 'papifast-90f21.firebaseapp.com',
				projectId: 'papifast-90f21',
				storageBucket: 'papifast-90f21.appspot.com',
				messagingSenderId: '423481031884',
				appId: '1:423481031884:web:8f2e02e4fd8bc9a0e55669',
				measurementId: 'G-0S2L6TXN0W',
			};

			// Inicializar Firebase
			const app = initializeApp(firebaseConfig);
			const db = getFirestore(app);

			// Referência ao documento único no Firestore
			const contentRef = doc(db, 'content', 'pages');

			// Elementos da UI
			const loadingState = document.getElementById('loading-state');
			const initializationState = document.getElementById(
				'initialization-state'
			);
			const editorState = document.getElementById('editor-state');
			const initializeButton =
				document.getElementById('initialize-button');
			const saveButton = document.getElementById('save-button');
			const statusMessage = document.getElementById('status-message');
			const homePageTextarea = document.getElementById('homePageContent');
			const businessPageTextarea = document.getElementById(
				'businessPageContent'
			);

			// Função para mostrar mensagens de status
			function showStatus(message, isError = false) {
				statusMessage.textContent = message;
				statusMessage.classList.remove(
					'hidden',
					'bg-green-500/20',
					'text-green-300',
					'bg-red-500/20',
					'text-red-300'
				);
				if (isError) {
					statusMessage.classList.add(
						'bg-red-500/20',
						'text-red-300'
					);
				} else {
					statusMessage.classList.add(
						'bg-green-500/20',
						'text-green-300'
					);
				}
				setTimeout(() => statusMessage.classList.add('hidden'), 5000);
			}

			// Função para carregar o conteúdo do Firestore
			async function loadContent() {
				try {
					const docSnap = await getDoc(contentRef);

					if (docSnap.exists()) {
						const data = docSnap.data();
						homePageTextarea.value = JSON.stringify(
							data.homePage || {},
							null,
							4
						);
						businessPageTextarea.value = JSON.stringify(
							data.businessPage || {},
							null,
							4
						);

						loadingState.classList.add('hidden');
						editorState.classList.remove('hidden');
					} else {
						loadingState.classList.add('hidden');
						initializationState.classList.remove('hidden');
					}
				} catch (error) {
					console.error('Erro ao carregar conteúdo:', error);
					showStatus(
						'Erro ao carregar conteúdo: ' + error.message,
						true
					);
					loadingState.innerHTML = `<p class="text-red-400">Erro ao conectar com o Firebase. Verifique a configuração e as regras de segurança do Firestore.</p>`;
				}
			}

			// Função para salvar o conteúdo no Firestore
			async function saveContent() {
				saveButton.disabled = true;
				saveButton.textContent = 'Salvando...';
				try {
					const homePageContent = JSON.parse(homePageTextarea.value);
					const businessPageContent = JSON.parse(
						businessPageTextarea.value
					);

					await setDoc(contentRef, {
						homePage: homePageContent,
						businessPage: businessPageContent,
					});

					showStatus('Conteúdo salvo com sucesso!', false);
				} catch (error) {
					console.error('Erro ao salvar conteúdo:', error);
					showStatus(
						'Erro ao salvar: Verifique se o formato JSON está correto. Detalhes: ' +
							error.message,
						true
					);
				} finally {
					saveButton.disabled = false;
					saveButton.textContent = 'Salvar Alterações';
				}
			}

			// Função para inicializar o conteúdo com dados padrão
			async function initializeContent() {
				initializeButton.disabled = true;
				initializeButton.textContent = 'Carregando...';

				const initialContent = {
					homePage: {
						hero: {
							title: "Sua festa organizada de um <span style='background: linear-gradient(90deg, #fb923c, #ef4444); -webkit-background-clip: text; background-clip: text; color: transparent;'>jeito simples e inovador</span>",
							subtitle:
								'Crie seu evento, envie convites digitais, monte sua lista de presentes e acompanhe tudo em tempo real – direto do celular.',
							primary_button: 'Criar meu evento agora',
							secondary_button: 'Saiba como funciona',
						},
						about: {
							title: 'O jeito moderno de organizar suas comemorações',
							description:
								'O Wevity é o aplicativo que simplifica a organização de festas, aniversários e eventos especiais. Em poucos cliques, você cria seu evento, adiciona produtos ou presentes, envia convites personalizados e acompanha tudo em tempo real.',
						},
						cta: {
							title: 'Pronto para a festa?',
							description:
								'Crie seu evento no Wevity agora e aproveite cada momento sem preocupações.',
							button: 'Criar meu evento agora',
						},
					},
					businessPage: {
						hero: {
							title: 'A Plataforma Completa para seu Negócio Decolar',
							subtitle:
								'Gestão de eventos, marketing automatizado e vendas integradas. Transforme a experiência do seu cliente e impulsione seus resultados com Wevity.',
							cta_button: 'Agendar uma Demonstração',
							secondary_button: 'Ver Funcionalidades',
						},
						valueProposition: {
							title: 'Transforme a Gestão, o Marketing e as Vendas do seu Negócio',
							items: [
								{
									icon: "<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><line x1='12' y1='1' x2='12' y2='23'></line><path d='M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6'></path></svg>",
									title: 'Aumente sua Receita',
									description:
										'Monetize seus eventos com um sistema de venda de ingressos online, crie campanhas de marketing que convertem e ofereça listas de presentes pagas diretamente na plataforma.',
								},
								{
									icon: "<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='23 6 13.5 15.5 8.5 10.5 1 18'></polyline><polyline points='17 6 23 6 23 12'></polyline></svg>",
									title: 'Otimize sua Gestão',
									description:
										'Centralize a criação de eventos, o controle de convidados (RSVP), a gestão de clientes (CRM) e a sincronização de produtos com seu PDV em um único lugar. Menos planilhas, mais resultados.',
								},
								{
									icon: "<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z'></path></svg>",
									title: 'Fidelize seus Clientes',
									description:
										'Crie um relacionamento duradouro enviando convites exclusivos, cupons de desconto e vouchers de presente diretamente via WhatsApp e E-mail. Transforme clientes em fãs.',
								},
							],
						},
						cta: {
							title: 'Pronto para levar seu negócio ao próximo nível?',
							description:
								'Agende uma demonstração gratuita e descubra como o Wevity pode transformar a gestão do seu estabelecimento.',
							button: 'Fale com um especialista',
						},
					},
				};

				try {
					await setDoc(contentRef, initialContent);
					showStatus(
						'Conteúdo inicial carregado com sucesso!',
						false
					);
					initializationState.classList.add('hidden');
					loadContent(); // Recarrega o conteúdo no editor
				} catch (error) {
					console.error('Erro ao inicializar conteúdo:', error);
					showStatus(
						'Erro ao inicializar conteúdo: ' + error.message,
						true
					);
					initializeButton.disabled = false;
					initializeButton.textContent = 'Tentar Novamente';
				}
			}

			// Adicionar listeners aos botões
			saveButton.addEventListener('click', saveContent);
			initializeButton.addEventListener('click', initializeContent);

			// Carregar o conteúdo inicial ao carregar a página
			loadContent();
		</script>
	</body>
</html>
